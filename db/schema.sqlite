CREATE TABLE IF NOT EXISTS members (
	id INTEGER PRIMARY KEY AUTOINCREMENT,
	first_name TEXT NOT NULL,
	last_name TEXT NOT NULL,
	email TEXT,
	phone TEXT,
	card_id TEXT UNIQUE NOT NULL,
	gov_id TEXT,
	package_id INTEGER,
	expires_at DATE,
	image TEXT,
	signature TEXT,
	notes TEXT,
	created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
	updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
	address_street TEXT,
	address_number TEXT,
	address_city TEXT,
	guardian BOOLEAN DEFAULT FALSE,
	guardian_first_name TEXT,
	guardian_last_name TEXT,
	guardian_gov_id TEXT,
	notify BOOLEAN DEFAULT TRUE,
	year_of_birth INTEGER,
	package_old TEXT,
	FOREIGN KEY (package_id) REFERENCES packages(id) ON UPDATE CASCADE ON DELETE SET NULL
);

CREATE TABLE IF NOT EXISTS packages (
	id INTEGER PRIMARY KEY AUTOINCREMENT,
	name TEXT NOT NULL,
	price REAL,
	description TEXT,
	display_order INTEGER,
	created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS visits (
	id INTEGER PRIMARY KEY AUTOINCREMENT,
	member_id INTEGER NOT NULL,
	visit_date DATE DEFAULT CURRENT_DATE,
	notes TEXT,
	created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
	FOREIGN KEY (member_id) REFERENCES members(id) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS messages (
	id INTEGER PRIMARY KEY AUTOINCREMENT,
	member_id INTEGER,
	subject TEXT,
	message TEXT,
	method TEXT DEFAULT 'email',
	created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
	FOREIGN KEY (member_id) REFERENCES members (id) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE INDEX IF NOT EXISTS idx_members_card_id ON members(card_id);
CREATE INDEX IF NOT EXISTS idx_visits_member_id ON visits(member_id);

