<UserControl xmlns="https://github.com/avaloniaui"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:local="using:Adrenalin.Converters"
	xmlns:views="using:Adrenalin.Views"
	xmlns:vm="using:Adrenalin.ViewModels"
	x:Class="Adrenalin.Views.MembersView" x:DataType="vm:MembersViewModel">
	<UserControl.Resources>
		<local:StringEqualsConverter x:Key="StringEqualsConverter" />
		<local:Int32GreaterThanConverter x:Key="Int32GreaterThanConverter" />
		<local:Int32LessThanConverter x:Key="Int32LessThanConverter" />
	</UserControl.Resources>
	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition Height="*" />
			<RowDefinition Height="Auto" />
		</Grid.RowDefinitions>

		<!-- Search and Actions -->
		<StackPanel Grid.Row="0" Margin="20,20,20,10" Spacing="10"
			IsVisible="{Binding CurrentView, Converter={StaticResource StringEqualsConverter}, ConverterParameter=list}">
			<TextBox Text="{Binding SearchQuery}" Watermark="{Binding SearchPlaceholder}" />
			<StackPanel Orientation="Horizontal" Spacing="10">
				<Button Content="{Binding AddMemberLabel}" Command="{Binding AddMember}" />
				<Button Content="Refresh" Command="{Binding LoadMembers}" />
			</StackPanel>
		</StackPanel>

		<!-- Back Button for Detail -->
		<Button Grid.Row="0"
			Content="{Binding BackToMembersLabel}"
			Command="{Binding BackToList}"
			Margin="20"
			IsVisible="{Binding CurrentView, Converter={StaticResource StringEqualsConverter}, ConverterParameter=detail}" />

		<!-- Members List -->
		<ListBox x:Name="MembersList" Grid.Row="1" Margin="20,20,20,20"
			ItemsSource="{Binding Members}"
			SelectedItem="{Binding SelectedMember}"
			IsVisible="{Binding CurrentView, Converter={StaticResource StringEqualsConverter}, ConverterParameter=list}">
			<ListBox.ItemTemplate>
				<DataTemplate>
					<Border Background="Transparent">
						<StackPanel Spacing="5" Orientation="Horizontal">
							<StackPanel Spacing="5">
								<TextBlock Text="{Binding FirstName, StringFormat='Name: {0} {1}'}"
									FontWeight="Bold" />
								<TextBlock Text="{Binding CardId, StringFormat='Card ID: {0}'}" />
								<TextBlock Text="{Binding Email, StringFormat='Email: {0}'}" />
								<TextBlock Text="{Binding PackageId, StringFormat='Package: {0}'}" />
								<TextBlock Text="{Binding ExpiresAt, StringFormat='Expires: {0:d}'}" />
							</StackPanel>
							<StackPanel Spacing="5" Orientation="Horizontal"
								VerticalAlignment="Center">
								<Button
									Content="{Binding $parent[ItemsControl].DataContext.ViewLabel}"
									Command="{Binding $parent[ItemsControl].DataContext.SelectMember}"
									CommandParameter="{Binding}" />
								<Button
									Content="{Binding $parent[ItemsControl].DataContext.EditLabel}"
									Command="{Binding $parent[ItemsControl].DataContext.SelectMember}"
									CommandParameter="{Binding}" />
								<Button
									Content="{Binding $parent[ItemsControl].DataContext.DeleteLabel}"
									Command="{Binding $parent[ItemsControl].DataContext.DeleteMember}"
									CommandParameter="{Binding}" />
							</StackPanel>
						</StackPanel>
					</Border>
				</DataTemplate>
			</ListBox.ItemTemplate>
		</ListBox>

		<!-- Member Detail -->
		<views:MemberDetailView x:Name="MemberDetail" Grid.Row="1"
			IsVisible="{Binding IsDetailVisible}" />

		<!-- Loading Indicator -->
		<TextBlock Grid.Row="1" Text="{Binding $parent[UserControl].DataContext.LoadingLabel}"
			IsVisible="{Binding IsLoading}" HorizontalAlignment="Center" VerticalAlignment="Center" />

		<!-- Pagination -->
		<StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="20"
			Spacing="10"
			IsVisible="{Binding CurrentView, Converter={StaticResource StringEqualsConverter}, ConverterParameter=list}">
			<Button Content="Previous" Command="{Binding PreviousPage}"
				IsEnabled="{Binding HasPreviousPage}" />
			<TextBlock Text="{Binding CurrentPage, StringFormat='Page {0} of {1}'}"
				VerticalAlignment="Center" />
			<Button Content="Next" Command="{Binding NextPage}" IsEnabled="{Binding HasNextPage}" />
		</StackPanel>
	</Grid>
</UserControl>
